---
title: noise
sidebar_position: 1
---

<!-- Code generated by gomarkdoc. DO NOT EDIT -->


# noise

```go
import "github.com/lookatitude/beluga-ai/pkg/voice/noise"
```

Package noise provides interfaces and implementations for Noise Cancellation. This package follows the Beluga AI Framework's design patterns for consistency, extensibility, configuration management, and observability.

Package noise provides advanced test utilities and comprehensive mocks for testing Noise Cancellation implementations.

## Index

- [Constants](<#constants>)
- [`func AssertNoiseCancellationInterface(t *testing.T, cancellation iface.NoiseCancellation)`](<#AssertNoiseCancellationInterface>)
- [`func InitMetrics(meter metric.Meter, tracer trace.Tracer)`](<#InitMetrics>)
- [`func IsRetryableError(err error) bool`](<#IsRetryableError>)
- [`func NewProvider(ctx context.Context, providerName string, config *Config, opts ...ConfigOption) (iface.NoiseCancellation, error)`](<#NewProvider>)
- [type AdvancedMockNoiseCancellation](<#AdvancedMockNoiseCancellation>)
  - [`func NewAdvancedMockNoiseCancellation(cancellationName string, opts ...MockOption) *AdvancedMockNoiseCancellation`](<#NewAdvancedMockNoiseCancellation>)
  - [`func (m *AdvancedMockNoiseCancellation) GetCallCount() int`](<#AdvancedMockNoiseCancellation.GetCallCount>)
  - [`func (m *AdvancedMockNoiseCancellation) Process(ctx context.Context, audio []byte) ([]byte, error)`](<#AdvancedMockNoiseCancellation.Process>)
  - [`func (m *AdvancedMockNoiseCancellation) ProcessStream(ctx context.Context, audioCh <-chan []byte) (<-chan []byte, error)`](<#AdvancedMockNoiseCancellation.ProcessStream>)
- [type Config](<#Config>)
  - [`func DefaultConfig() *Config`](<#DefaultConfig>)
  - [`func (c *Config) Validate() error`](<#Config.Validate>)
- [type ConfigOption](<#ConfigOption>)
  - [`func WithEnableAdaptiveProcessing(enable bool) ConfigOption`](<#WithEnableAdaptiveProcessing>)
  - [`func WithFrameSize(frameSize int) ConfigOption`](<#WithFrameSize>)
  - [`func WithModelPath(path string) ConfigOption`](<#WithModelPath>)
  - [`func WithNoiseReductionLevel(level float64) ConfigOption`](<#WithNoiseReductionLevel>)
  - [`func WithProvider(provider string) ConfigOption`](<#WithProvider>)
  - [`func WithSampleRate(sampleRate int) ConfigOption`](<#WithSampleRate>)
- [type Metrics](<#Metrics>)
  - [`func GetMetrics() *Metrics`](<#GetMetrics>)
  - [`func NewMetrics(meter metric.Meter, tracer trace.Tracer) *Metrics`](<#NewMetrics>)
  - [`func NoOpMetrics() *Metrics`](<#NoOpMetrics>)
  - [`func (m *Metrics) IncrementProcessedFrames(ctx context.Context, provider string)`](<#Metrics.IncrementProcessedFrames>)
  - [`func (m *Metrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)`](<#Metrics.RecordError>)
  - [`func (m *Metrics) RecordProcessing(ctx context.Context, provider string, duration time.Duration, inputSize, outputSize int64)`](<#Metrics.RecordProcessing>)
- [type MetricsRecorder](<#MetricsRecorder>)
- [type MockOption](<#MockOption>)
  - [`func WithCancellationName(name string) MockOption`](<#WithCancellationName>)
  - [`func WithError(err error) MockOption`](<#WithError>)
  - [`func WithMockNoiseReductionLevel(level float64) MockOption`](<#WithMockNoiseReductionLevel>)
  - [`func WithNetworkDelay(enabled bool) MockOption`](<#WithNetworkDelay>)
  - [`func WithProcessedAudio(audio ...[]byte) MockOption`](<#WithProcessedAudio>)
  - [`func WithProcessingDelay(delay time.Duration) MockOption`](<#WithProcessingDelay>)
- [type NoiseCancellationError](<#NoiseCancellationError>)
  - [`func NewNoiseCancellationError(op, code string, err error) *NoiseCancellationError`](<#NewNoiseCancellationError>)
  - [`func NewNoiseCancellationErrorWithDetails(op, code, message string, err error, details map[string]any) *NoiseCancellationError`](<#NewNoiseCancellationErrorWithDetails>)
  - [`func NewNoiseCancellationErrorWithMessage(op, code, message string, err error) *NoiseCancellationError`](<#NewNoiseCancellationErrorWithMessage>)
  - [`func (e *NoiseCancellationError) Error() string`](<#NoiseCancellationError.Error>)
  - [`func (e *NoiseCancellationError) Unwrap() error`](<#NoiseCancellationError.Unwrap>)
- [type Registry](<#Registry>)
  - [`func GetRegistry() *Registry`](<#GetRegistry>)
  - [`func (r *Registry) GetProvider(name string, config *Config) (iface.NoiseCancellation, error)`](<#Registry.GetProvider>)
  - [`func (r *Registry) IsRegistered(name string) bool`](<#Registry.IsRegistered>)
  - [`func (r *Registry) ListProviders() []string`](<#Registry.ListProviders>)
  - [`func (r *Registry) Register(name string, factory func(*Config) (iface.NoiseCancellation, error))`](<#Registry.Register>)

## Constants

<a name="ErrCodeInvalidConfig"></a>Error codes for Noise Cancellation operations.

```go
const (
    // General errors.
    ErrCodeInvalidConfig = "invalid_config"
    ErrCodeInternalError = "internal_error"
    ErrCodeInvalidInput  = "invalid_input"
    ErrCodeTimeout       = "timeout"

    // Provider-specific errors.
    ErrCodeUnsupportedProvider = "unsupported_provider"
    ErrCodeModelLoadFailed     = "model_load_failed"
    ErrCodeModelNotFound       = "model_not_found"

    // Processing errors.
    ErrCodeProcessingError = "processing_error"
    ErrCodeFrameSizeError  = "frame_size_error"
    ErrCodeSampleRateError = "sample_rate_error"

    // Context errors.
    ErrCodeContextCanceled = "context_canceled"
    ErrCodeContextTimeout  = "context_timeout"
)
```

<a name="AssertNoiseCancellationInterface"></a>
## func [AssertNoiseCancellationInterface](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L216>)

```go
func AssertNoiseCancellationInterface(t *testing.T, cancellation iface.NoiseCancellation)
```

AssertNoiseCancellationInterface ensures that a type implements the NoiseCancellation interface.

<a name="InitMetrics"></a>
## func [InitMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/noise.go#L34>)

```go
func InitMetrics(meter metric.Meter, tracer trace.Tracer)
```

InitMetrics initializes the global metrics instance for Noise Cancellation operations. This should be called once during application startup to enable metrics collection.

Parameters:

- meter: OpenTelemetry meter for creating metrics instruments

Example:

```
meter := otel.Meter("beluga.voice.noise")
noise.InitMetrics(meter)
```

Example usage can be found in examples/voice/noise/main.go

<a name="IsRetryableError"></a>
## func [IsRetryableError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L88>)

```go
func IsRetryableError(err error) bool
```

IsRetryableError checks if an error is retryable.

<a name="NewProvider"></a>
## func [NewProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/noise.go#L85>)

```go
func NewProvider(ctx context.Context, providerName string, config *Config, opts ...ConfigOption) (iface.NoiseCancellation, error)
```

NewProvider creates a new Noise Cancellation provider instance based on the configuration. It uses the global registry to find and instantiate the appropriate provider. Noise Cancellation removes background noise from audio streams to improve speech quality. Supported providers include: rnnoise, etc.

Parameters:

- ctx: Context for cancellation and timeout control
- providerName: Name of the noise cancellation provider to use (e.g., "rnnoise")
- config: Noise cancellation configuration (can be nil to use defaults)
- opts: Optional configuration functions to customize the config

Returns:

- iface.NoiseCancellation: A new noise cancellation instance ready to use
- error: Configuration validation errors or provider creation errors

Example:

```
config := noise.DefaultConfig()
provider, err := noise.NewProvider(ctx, "rnnoise", config,
    noise.WithAggressiveness(0.5),
)
if err != nil {
    log.Fatal(err)
}
cleanedAudio, err := provider.CancelNoise(ctx, audioData)
```

Example usage can be found in examples/voice/noise/main.go

<a name="AdvancedMockNoiseCancellation"></a>
## type [AdvancedMockNoiseCancellation](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L16-L28>)

AdvancedMockNoiseCancellation provides a comprehensive mock implementation for testing.

```go
type AdvancedMockNoiseCancellation struct {
    mock.Mock
    // contains filtered or unexported fields
}
```

<a name="NewAdvancedMockNoiseCancellation"></a>
### func [NewAdvancedMockNoiseCancellation](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L31>)

```go
func NewAdvancedMockNoiseCancellation(cancellationName string, opts ...MockOption) *AdvancedMockNoiseCancellation
```

NewAdvancedMockNoiseCancellation creates a new advanced mock with configurable behavior.

<a name="AdvancedMockNoiseCancellation.GetCallCount"></a>
### func (*AdvancedMockNoiseCancellation) [GetCallCount](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L209>)

```go
func (m *AdvancedMockNoiseCancellation) GetCallCount() int
```

GetCallCount returns the number of times Process has been called.

<a name="AdvancedMockNoiseCancellation.Process"></a>
### func (*AdvancedMockNoiseCancellation) [Process](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L94>)

```go
func (m *AdvancedMockNoiseCancellation) Process(ctx context.Context, audio []byte) ([]byte, error)
```

Process implements the NoiseCancellation interface.

<a name="AdvancedMockNoiseCancellation.ProcessStream"></a>
### func (*AdvancedMockNoiseCancellation) [ProcessStream](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L149>)

```go
func (m *AdvancedMockNoiseCancellation) ProcessStream(ctx context.Context, audioCh <-chan []byte) (<-chan []byte, error)
```

ProcessStream implements the NoiseCancellation interface.

<a name="Config"></a>
## type [Config](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L12-L24>)

Config represents the configuration for Noise Cancellation providers. It includes common settings that apply to all Noise Cancellation providers.

```go
type Config struct {
    ProviderSpecific         map[string]any `mapstructure:"provider_specific" yaml:"provider_specific"`
    Provider                 string         `mapstructure:"provider" yaml:"provider" validate:"required,oneof=rnnoise webrtc spectral"`
    ModelPath                string         `mapstructure:"model_path" yaml:"model_path"`
    NoiseReductionLevel      float64        `mapstructure:"noise_reduction_level" yaml:"noise_reduction_level" default:"0.5" validate:"gte=0.0,lte=1.0"`
    SampleRate               int            `mapstructure:"sample_rate" yaml:"sample_rate" default:"16000" validate:"oneof=8000 16000 22050 24000 32000 44100 48000"`
    FrameSize                int            `mapstructure:"frame_size" yaml:"frame_size" default:"480" validate:"min=64,max=4096"`
    Timeout                  time.Duration  `mapstructure:"timeout" yaml:"timeout" default:"1s" validate:"min=100ms,max=10s"`
    EnableAdaptiveProcessing bool           `mapstructure:"enable_adaptive_processing" yaml:"enable_adaptive_processing" default:"true"`
    EnableTracing            bool           `mapstructure:"enable_tracing" yaml:"enable_tracing" default:"true"`
    EnableMetrics            bool           `mapstructure:"enable_metrics" yaml:"enable_metrics" default:"true"`
    EnableStructuredLogging  bool           `mapstructure:"enable_structured_logging" yaml:"enable_structured_logging" default:"true"`
}
```

<a name="DefaultConfig"></a>
### func [DefaultConfig](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L81>)

```go
func DefaultConfig() *Config
```

DefaultConfig returns a default configuration.

<a name="Config.Validate"></a>
### func (*Config) [Validate](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L72>)

```go
func (c *Config) Validate() error
```

Validate validates the configuration.

<a name="ConfigOption"></a>
## type [ConfigOption](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L27>)

ConfigOption is a functional option for configuring Noise Cancellation instances.

```go
type ConfigOption func(*Config)
```

<a name="WithEnableAdaptiveProcessing"></a>
### func [WithEnableAdaptiveProcessing](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L58>)

```go
func WithEnableAdaptiveProcessing(enable bool) ConfigOption
```

WithEnableAdaptiveProcessing sets adaptive processing enablement.

<a name="WithFrameSize"></a>
### func [WithFrameSize](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L44>)

```go
func WithFrameSize(frameSize int) ConfigOption
```

WithFrameSize sets the frame size.

<a name="WithModelPath"></a>
### func [WithModelPath](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L65>)

```go
func WithModelPath(path string) ConfigOption
```

WithModelPath sets the model path.

<a name="WithNoiseReductionLevel"></a>
### func [WithNoiseReductionLevel](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L37>)

```go
func WithNoiseReductionLevel(level float64) ConfigOption
```

WithNoiseReductionLevel sets the noise reduction level.

<a name="WithProvider"></a>
### func [WithProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L30>)

```go
func WithProvider(provider string) ConfigOption
```

WithProvider sets the Noise Cancellation provider.

<a name="WithSampleRate"></a>
### func [WithSampleRate](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/config.go#L51>)

```go
func WithSampleRate(sampleRate int) ConfigOption
```

WithSampleRate sets the sample rate.

<a name="Metrics"></a>
## type [Metrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L29-L36>)

Metrics contains all the metrics for Noise Cancellation operations.

```go
type Metrics struct {
    // contains filtered or unexported fields
}
```

<a name="GetMetrics"></a>
### func [GetMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/noise.go#L54>)

```go
func GetMetrics() *Metrics
```

GetMetrics returns the global metrics instance. Returns nil if InitMetrics has not been called.

Returns:

- *Metrics: The global metrics instance, or nil if not initialized

Example:

```
metrics := noise.GetMetrics()
if metrics != nil {
    // Use metrics
}
```

Example usage can be found in examples/voice/noise/main.go

<a name="NewMetrics"></a>
### func [NewMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L39>)

```go
func NewMetrics(meter metric.Meter, tracer trace.Tracer) *Metrics
```

NewMetrics creates a new Metrics instance.

<a name="NoOpMetrics"></a>
### func [NoOpMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L22>)

```go
func NoOpMetrics() *Metrics
```

NoOpMetrics returns a metrics instance that does nothing. Useful for testing or when metrics are disabled.

<a name="Metrics.IncrementProcessedFrames"></a>
### func (*Metrics) [IncrementProcessedFrames](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L96>)

```go
func (m *Metrics) IncrementProcessedFrames(ctx context.Context, provider string)
```

IncrementProcessedFrames increments the processed frames counter.

<a name="Metrics.RecordError"></a>
### func (*Metrics) [RecordError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L79>)

```go
func (m *Metrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
```

RecordError records an error.

<a name="Metrics.RecordProcessing"></a>
### func (*Metrics) [RecordProcessing](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L57>)

```go
func (m *Metrics) RecordProcessing(ctx context.Context, provider string, duration time.Duration, inputSize, outputSize int64)
```

RecordProcessing records a processing operation.

<a name="MetricsRecorder"></a>
## type [MetricsRecorder](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/metrics.go#L14-L18>)

MetricsRecorder defines the interface for recording metrics.

```go
type MetricsRecorder interface {
    RecordProcessing(ctx context.Context, provider string, duration time.Duration, inputSize, outputSize int64)
    RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
    IncrementProcessedFrames(ctx context.Context, provider string)
}
```

<a name="MockOption"></a>
## type [MockOption](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L48>)

MockOption configures the behavior of AdvancedMockNoiseCancellation.

```go
type MockOption func(*AdvancedMockNoiseCancellation)
```

<a name="WithCancellationName"></a>
### func [WithCancellationName](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L51>)

```go
func WithCancellationName(name string) MockOption
```

WithCancellationName sets the cancellation name.

<a name="WithError"></a>
### func [WithError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L65>)

```go
func WithError(err error) MockOption
```

WithError configures the mock to return an error.

<a name="WithMockNoiseReductionLevel"></a>
### func [WithMockNoiseReductionLevel](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L87>)

```go
func WithMockNoiseReductionLevel(level float64) MockOption
```

WithMockNoiseReductionLevel sets the noise reduction level for the mock.

<a name="WithNetworkDelay"></a>
### func [WithNetworkDelay](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L80>)

```go
func WithNetworkDelay(enabled bool) MockOption
```

WithNetworkDelay enables network delay simulation.

<a name="WithProcessedAudio"></a>
### func [WithProcessedAudio](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L58>)

```go
func WithProcessedAudio(audio ...[]byte) MockOption
```

WithProcessedAudio sets the processed audio to return.

<a name="WithProcessingDelay"></a>
### func [WithProcessingDelay](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/test_utils.go#L73>)

```go
func WithProcessingDelay(delay time.Duration) MockOption
```

WithProcessingDelay sets the delay for processing.

<a name="NoiseCancellationError"></a>
## type [NoiseCancellationError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L33-L39>)

NoiseCancellationError represents an error that occurred during Noise Cancellation operations. It includes an operation name, underlying error, and error code for programmatic handling.

```go
type NoiseCancellationError struct {
    Err     error
    Details map[string]any
    Op      string
    Code    string
    Message string
}
```

<a name="NewNoiseCancellationError"></a>
### func [NewNoiseCancellationError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L58>)

```go
func NewNoiseCancellationError(op, code string, err error) *NoiseCancellationError
```

NewNoiseCancellationError creates a new NoiseCancellationError.

<a name="NewNoiseCancellationErrorWithDetails"></a>
### func [NewNoiseCancellationErrorWithDetails](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L77>)

```go
func NewNoiseCancellationErrorWithDetails(op, code, message string, err error, details map[string]any) *NoiseCancellationError
```

NewNoiseCancellationErrorWithDetails creates a new NoiseCancellationError with additional details.

<a name="NewNoiseCancellationErrorWithMessage"></a>
### func [NewNoiseCancellationErrorWithMessage](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L67>)

```go
func NewNoiseCancellationErrorWithMessage(op, code, message string, err error) *NoiseCancellationError
```

NewNoiseCancellationErrorWithMessage creates a new NoiseCancellationError with a custom message.

<a name="NoiseCancellationError.Error"></a>
### func (*NoiseCancellationError) [Error](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L42>)

```go
func (e *NoiseCancellationError) Error() string
```

Error implements the error interface.

<a name="NoiseCancellationError.Unwrap"></a>
### func (*NoiseCancellationError) [Unwrap](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/errors.go#L53>)

```go
func (e *NoiseCancellationError) Unwrap() error
```

Unwrap returns the underlying error.

<a name="Registry"></a>
## type [Registry](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L17-L20>)

Registry manages Noise Cancellation provider registration and retrieval.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="GetRegistry"></a>
### func [GetRegistry](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L23>)

```go
func GetRegistry() *Registry
```

GetRegistry returns the global registry instance.

<a name="Registry.GetProvider"></a>
### func (*Registry) [GetProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L40>)

```go
func (r *Registry) GetProvider(name string, config *Config) (iface.NoiseCancellation, error)
```

GetProvider returns a provider instance for the given name.

<a name="Registry.IsRegistered"></a>
### func (*Registry) [IsRegistered](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L66>)

```go
func (r *Registry) IsRegistered(name string) bool
```

IsRegistered checks if a provider is registered.

<a name="Registry.ListProviders"></a>
### func (*Registry) [ListProviders](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L54>)

```go
func (r *Registry) ListProviders() []string
```

ListProviders returns a list of all registered provider names.

<a name="Registry.Register"></a>
### func (*Registry) [Register](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/noise/registry.go#L33>)

```go
func (r *Registry) Register(name string, factory func(*Config) (iface.NoiseCancellation, error))
```

Register registers a provider factory function.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
