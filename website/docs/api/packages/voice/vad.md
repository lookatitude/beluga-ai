---
title: vad
sidebar_position: 1
---

<!-- Code generated by gomarkdoc. DO NOT EDIT -->


# vad

```go
import "github.com/lookatitude/beluga-ai/pkg/voice/vad"
```

Package vad provides advanced test utilities and comprehensive mocks for testing VAD implementations.

Package vad provides interfaces and implementations for Voice Activity Detection \(VAD\). This package follows the Beluga AI Framework's design patterns for consistency, extensibility, configuration management, and observability.

## Index

- [Constants](<#constants>)
- [func AssertVADProviderInterface\(t \*testing.T, provider iface.VADProvider\)](<#AssertVADProviderInterface>)
- [func InitMetrics\(meter metric.Meter\)](<#InitMetrics>)
- [func IsRetryableError\(err error\) bool](<#IsRetryableError>)
- [func NewProvider\(ctx context.Context, providerName string, config \*Config, opts ...ConfigOption\) \(iface.VADProvider, error\)](<#NewProvider>)
- [type AdvancedMockVADProvider](<#AdvancedMockVADProvider>)
  - [func NewAdvancedMockVADProvider\(providerName string, opts ...MockOption\) \*AdvancedMockVADProvider](<#NewAdvancedMockVADProvider>)
  - [func \(m \*AdvancedMockVADProvider\) GetCallCount\(\) int](<#AdvancedMockVADProvider.GetCallCount>)
  - [func \(m \*AdvancedMockVADProvider\) Process\(ctx context.Context, audio \[\]byte\) \(bool, error\)](<#AdvancedMockVADProvider.Process>)
  - [func \(m \*AdvancedMockVADProvider\) ProcessStream\(ctx context.Context, audioCh \<\-chan \[\]byte\) \(\<\-chan iface.VADResult, error\)](<#AdvancedMockVADProvider.ProcessStream>)
- [type Config](<#Config>)
  - [func DefaultConfig\(\) \*Config](<#DefaultConfig>)
  - [func \(c \*Config\) Validate\(\) error](<#Config.Validate>)
- [type ConfigOption](<#ConfigOption>)
  - [func WithEnablePreprocessing\(enable bool\) ConfigOption](<#WithEnablePreprocessing>)
  - [func WithFrameSize\(frameSize int\) ConfigOption](<#WithFrameSize>)
  - [func WithMaxSilenceDuration\(duration time.Duration\) ConfigOption](<#WithMaxSilenceDuration>)
  - [func WithMinSpeechDuration\(duration time.Duration\) ConfigOption](<#WithMinSpeechDuration>)
  - [func WithModelPath\(path string\) ConfigOption](<#WithModelPath>)
  - [func WithProvider\(provider string\) ConfigOption](<#WithProvider>)
  - [func WithSampleRate\(sampleRate int\) ConfigOption](<#WithSampleRate>)
  - [func WithThreshold\(threshold float64\) ConfigOption](<#WithThreshold>)
- [type Metrics](<#Metrics>)
  - [func GetMetrics\(\) \*Metrics](<#GetMetrics>)
  - [func NewMetrics\(meter metric.Meter\) \*Metrics](<#NewMetrics>)
  - [func \(m \*Metrics\) IncrementProcessedFrames\(ctx context.Context, provider string\)](<#Metrics.IncrementProcessedFrames>)
  - [func \(m \*Metrics\) RecordError\(ctx context.Context, provider, errorCode string, duration time.Duration\)](<#Metrics.RecordError>)
  - [func \(m \*Metrics\) RecordProcessing\(ctx context.Context, provider string, duration time.Duration, detected bool\)](<#Metrics.RecordProcessing>)
- [type MetricsRecorder](<#MetricsRecorder>)
- [type MockOption](<#MockOption>)
  - [func WithError\(err error\) MockOption](<#WithError>)
  - [func WithNetworkDelay\(enabled bool\) MockOption](<#WithNetworkDelay>)
  - [func WithProcessingDelay\(delay time.Duration\) MockOption](<#WithProcessingDelay>)
  - [func WithProviderName\(name string\) MockOption](<#WithProviderName>)
  - [func WithSpeechResults\(results ...bool\) MockOption](<#WithSpeechResults>)
- [type NoOpMetrics](<#NoOpMetrics>)
  - [func NewNoOpMetrics\(\) \*NoOpMetrics](<#NewNoOpMetrics>)
  - [func \(n \*NoOpMetrics\) IncrementProcessedFrames\(ctx context.Context, provider string\)](<#NoOpMetrics.IncrementProcessedFrames>)
  - [func \(n \*NoOpMetrics\) RecordError\(ctx context.Context, provider, errorCode string, duration time.Duration\)](<#NoOpMetrics.RecordError>)
  - [func \(n \*NoOpMetrics\) RecordProcessing\(ctx context.Context, provider string, duration time.Duration, detected bool\)](<#NoOpMetrics.RecordProcessing>)
- [type Registry](<#Registry>)
  - [func GetRegistry\(\) \*Registry](<#GetRegistry>)
  - [func \(r \*Registry\) GetProvider\(name string, config \*Config\) \(iface.VADProvider, error\)](<#Registry.GetProvider>)
  - [func \(r \*Registry\) IsRegistered\(name string\) bool](<#Registry.IsRegistered>)
  - [func \(r \*Registry\) ListProviders\(\) \[\]string](<#Registry.ListProviders>)
  - [func \(r \*Registry\) Register\(name string, factory func\(\*Config\) \(iface.VADProvider, error\)\)](<#Registry.Register>)
- [type VADError](<#VADError>)
  - [func NewVADError\(op, code string, err error\) \*VADError](<#NewVADError>)
  - [func NewVADErrorWithDetails\(op, code, message string, err error, details map\[string\]any\) \*VADError](<#NewVADErrorWithDetails>)
  - [func NewVADErrorWithMessage\(op, code, message string, err error\) \*VADError](<#NewVADErrorWithMessage>)
  - [func \(e \*VADError\) Error\(\) string](<#VADError.Error>)
  - [func \(e \*VADError\) Unwrap\(\) error](<#VADError.Unwrap>)

## Constants

<a name="ErrCodeInvalidConfig"></a>Error codes for VAD operations.

```go
const (
    // General errors.
    ErrCodeInvalidConfig = "invalid_config"
    ErrCodeInternalError = "internal_error"
    ErrCodeInvalidInput  = "invalid_input"
    ErrCodeTimeout       = "timeout"

    // Provider-specific errors.
    ErrCodeUnsupportedProvider = "unsupported_provider"
    ErrCodeModelLoadFailed     = "model_load_failed"
    ErrCodeModelNotFound       = "model_not_found"

    // Processing errors.
    ErrCodeProcessingError = "processing_error"
    ErrCodeFrameSizeError  = "frame_size_error"
    ErrCodeSampleRateError = "sample_rate_error"

    // Context errors.
    ErrCodeContextCanceled = "context_canceled"
    ErrCodeContextTimeout  = "context_timeout"
)
```

<a name="AssertVADProviderInterface"></a>
## func [AssertVADProviderInterface](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L199>)

```go
func AssertVADProviderInterface(t *testing.T, provider iface.VADProvider)
```

AssertVADProviderInterface ensures that a type implements the VADProvider interface.

<a name="InitMetrics"></a>
## func [InitMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/vad.go#L22>)

```go
func InitMetrics(meter metric.Meter)
```

InitMetrics initializes the global metrics instance.

<a name="IsRetryableError"></a>
## func [IsRetryableError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L88>)

```go
func IsRetryableError(err error) bool
```

IsRetryableError checks if an error is retryable.

<a name="NewProvider"></a>
## func [NewProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/vad.go#L35>)

```go
func NewProvider(ctx context.Context, providerName string, config *Config, opts ...ConfigOption) (iface.VADProvider, error)
```

NewProvider creates a new VAD provider instance based on the configuration. It uses the global registry to find and instantiate the appropriate provider.

<a name="AdvancedMockVADProvider"></a>
## type [AdvancedMockVADProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L16-L27>)

AdvancedMockVADProvider provides a comprehensive mock implementation for testing.

```go
type AdvancedMockVADProvider struct {
    mock.Mock
    // contains filtered or unexported fields
}
```

<a name="NewAdvancedMockVADProvider"></a>
### func [NewAdvancedMockVADProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L30>)

```go
func NewAdvancedMockVADProvider(providerName string, opts ...MockOption) *AdvancedMockVADProvider
```

NewAdvancedMockVADProvider creates a new advanced mock with configurable behavior.

<a name="AdvancedMockVADProvider.GetCallCount"></a>
### func \(\*AdvancedMockVADProvider\) [GetCallCount](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L192>)

```go
func (m *AdvancedMockVADProvider) GetCallCount() int
```

GetCallCount returns the number of times Process has been called.

<a name="AdvancedMockVADProvider.Process"></a>
### func \(\*AdvancedMockVADProvider\) [Process](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L85>)

```go
func (m *AdvancedMockVADProvider) Process(ctx context.Context, audio []byte) (bool, error)
```

Process implements the VADProvider interface.

<a name="AdvancedMockVADProvider.ProcessStream"></a>
### func \(\*AdvancedMockVADProvider\) [ProcessStream](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L134>)

```go
func (m *AdvancedMockVADProvider) ProcessStream(ctx context.Context, audioCh <-chan []byte) (<-chan iface.VADResult, error)
```

ProcessStream implements the VADProvider interface.

<a name="Config"></a>
## type [Config](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L12-L26>)

Config represents the configuration for VAD providers. It includes common settings that apply to all VAD providers.

```go
type Config struct {
    ProviderSpecific        map[string]any `mapstructure:"provider_specific" yaml:"provider_specific"`
    Provider                string         `mapstructure:"provider" yaml:"provider" validate:"required,oneof=silero energy webrtc rnnoise"`
    ModelPath               string         `mapstructure:"model_path" yaml:"model_path"`
    SampleRate              int            `mapstructure:"sample_rate" yaml:"sample_rate" default:"16000" validate:"oneof=8000 16000 22050 24000 32000 44100 48000"`
    MinSpeechDuration       time.Duration  `mapstructure:"min_speech_duration" yaml:"min_speech_duration" default:"250ms" validate:"min=50ms,max=2s"`
    MaxSilenceDuration      time.Duration  `mapstructure:"max_silence_duration" yaml:"max_silence_duration" default:"500ms" validate:"min=100ms,max=5s"`
    FrameSize               int            `mapstructure:"frame_size" yaml:"frame_size" default:"512" validate:"min=64,max=4096"`
    Timeout                 time.Duration  `mapstructure:"timeout" yaml:"timeout" default:"1s" validate:"min=100ms,max=10s"`
    Threshold               float64        `mapstructure:"threshold" yaml:"threshold" default:"0.5" validate:"gte=0.0,lte=1.0"`
    EnablePreprocessing     bool           `mapstructure:"enable_preprocessing" yaml:"enable_preprocessing" default:"true"`
    EnableTracing           bool           `mapstructure:"enable_tracing" yaml:"enable_tracing" default:"true"`
    EnableMetrics           bool           `mapstructure:"enable_metrics" yaml:"enable_metrics" default:"true"`
    EnableStructuredLogging bool           `mapstructure:"enable_structured_logging" yaml:"enable_structured_logging" default:"true"`
}
```

<a name="DefaultConfig"></a>
### func [DefaultConfig](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L97>)

```go
func DefaultConfig() *Config
```

DefaultConfig returns a default configuration.

<a name="Config.Validate"></a>
### func \(\*Config\) [Validate](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L88>)

```go
func (c *Config) Validate() error
```

Validate validates the configuration.

<a name="ConfigOption"></a>
## type [ConfigOption](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L29>)

ConfigOption is a functional option for configuring VAD instances.

```go
type ConfigOption func(*Config)
```

<a name="WithEnablePreprocessing"></a>
### func [WithEnablePreprocessing](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L74>)

```go
func WithEnablePreprocessing(enable bool) ConfigOption
```

WithEnablePreprocessing sets preprocessing enablement.

<a name="WithFrameSize"></a>
### func [WithFrameSize](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L46>)

```go
func WithFrameSize(frameSize int) ConfigOption
```

WithFrameSize sets the frame size.

<a name="WithMaxSilenceDuration"></a>
### func [WithMaxSilenceDuration](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L67>)

```go
func WithMaxSilenceDuration(duration time.Duration) ConfigOption
```

WithMaxSilenceDuration sets the maximum silence duration.

<a name="WithMinSpeechDuration"></a>
### func [WithMinSpeechDuration](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L60>)

```go
func WithMinSpeechDuration(duration time.Duration) ConfigOption
```

WithMinSpeechDuration sets the minimum speech duration.

<a name="WithModelPath"></a>
### func [WithModelPath](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L81>)

```go
func WithModelPath(path string) ConfigOption
```

WithModelPath sets the model path.

<a name="WithProvider"></a>
### func [WithProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L32>)

```go
func WithProvider(provider string) ConfigOption
```

WithProvider sets the VAD provider.

<a name="WithSampleRate"></a>
### func [WithSampleRate](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L53>)

```go
func WithSampleRate(sampleRate int) ConfigOption
```

WithSampleRate sets the sample rate.

<a name="WithThreshold"></a>
### func [WithThreshold](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/config.go#L39>)

```go
func WithThreshold(threshold float64) ConfigOption
```

WithThreshold sets the speech detection threshold.

<a name="Metrics"></a>
## type [Metrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L38-L44>)

Metrics contains all the metrics for VAD operations.

```go
type Metrics struct {
    // contains filtered or unexported fields
}
```

<a name="GetMetrics"></a>
### func [GetMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/vad.go#L29>)

```go
func GetMetrics() *Metrics
```

GetMetrics returns the global metrics instance.

<a name="NewMetrics"></a>
### func [NewMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L47>)

```go
func NewMetrics(meter metric.Meter) *Metrics
```

NewMetrics creates a new Metrics instance.

<a name="Metrics.IncrementProcessedFrames"></a>
### func \(\*Metrics\) [IncrementProcessedFrames](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L85>)

```go
func (m *Metrics) IncrementProcessedFrames(ctx context.Context, provider string)
```

IncrementProcessedFrames increments the processed frames counter.

<a name="Metrics.RecordError"></a>
### func \(\*Metrics\) [RecordError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L75>)

```go
func (m *Metrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
```

RecordError records an error.

<a name="Metrics.RecordProcessing"></a>
### func \(\*Metrics\) [RecordProcessing](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L60>)

```go
func (m *Metrics) RecordProcessing(ctx context.Context, provider string, duration time.Duration, detected bool)
```

RecordProcessing records a processing operation.

<a name="MetricsRecorder"></a>
## type [MetricsRecorder](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L12-L16>)

MetricsRecorder defines the interface for recording metrics.

```go
type MetricsRecorder interface {
    RecordProcessing(ctx context.Context, provider string, duration time.Duration, detected bool)
    RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
    IncrementProcessedFrames(ctx context.Context, provider string)
}
```

<a name="MockOption"></a>
## type [MockOption](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L46>)

MockOption configures the behavior of AdvancedMockVADProvider.

```go
type MockOption func(*AdvancedMockVADProvider)
```

<a name="WithError"></a>
### func [WithError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L63>)

```go
func WithError(err error) MockOption
```

WithError configures the mock to return an error.

<a name="WithNetworkDelay"></a>
### func [WithNetworkDelay](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L78>)

```go
func WithNetworkDelay(enabled bool) MockOption
```

WithNetworkDelay enables network delay simulation.

<a name="WithProcessingDelay"></a>
### func [WithProcessingDelay](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L71>)

```go
func WithProcessingDelay(delay time.Duration) MockOption
```

WithProcessingDelay sets the delay for processing.

<a name="WithProviderName"></a>
### func [WithProviderName](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L49>)

```go
func WithProviderName(name string) MockOption
```

WithProviderName sets the provider name.

<a name="WithSpeechResults"></a>
### func [WithSpeechResults](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/test_utils.go#L56>)

```go
func WithSpeechResults(results ...bool) MockOption
```

WithSpeechResults sets the speech detection results to return.

<a name="NoOpMetrics"></a>
## type [NoOpMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L19>)

NoOpMetrics provides a no\-operation implementation for when metrics are disabled.

```go
type NoOpMetrics struct{}
```

<a name="NewNoOpMetrics"></a>
### func [NewNoOpMetrics](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L22>)

```go
func NewNoOpMetrics() *NoOpMetrics
```

NewNoOpMetrics creates a new no\-operation metrics recorder.

<a name="NoOpMetrics.IncrementProcessedFrames"></a>
### func \(\*NoOpMetrics\) [IncrementProcessedFrames](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L35>)

```go
func (n *NoOpMetrics) IncrementProcessedFrames(ctx context.Context, provider string)
```

IncrementProcessedFrames is a no\-op implementation.

<a name="NoOpMetrics.RecordError"></a>
### func \(\*NoOpMetrics\) [RecordError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L31>)

```go
func (n *NoOpMetrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
```

RecordError is a no\-op implementation.

<a name="NoOpMetrics.RecordProcessing"></a>
### func \(\*NoOpMetrics\) [RecordProcessing](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/metrics.go#L27>)

```go
func (n *NoOpMetrics) RecordProcessing(ctx context.Context, provider string, duration time.Duration, detected bool)
```

RecordProcessing is a no\-op implementation.

<a name="Registry"></a>
## type [Registry](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L17-L20>)

Registry manages VAD provider registration and retrieval.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="GetRegistry"></a>
### func [GetRegistry](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L23>)

```go
func GetRegistry() *Registry
```

GetRegistry returns the global registry instance.

<a name="Registry.GetProvider"></a>
### func \(\*Registry\) [GetProvider](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L40>)

```go
func (r *Registry) GetProvider(name string, config *Config) (iface.VADProvider, error)
```

GetProvider returns a provider instance for the given name.

<a name="Registry.IsRegistered"></a>
### func \(\*Registry\) [IsRegistered](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L66>)

```go
func (r *Registry) IsRegistered(name string) bool
```

IsRegistered checks if a provider is registered.

<a name="Registry.ListProviders"></a>
### func \(\*Registry\) [ListProviders](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L54>)

```go
func (r *Registry) ListProviders() []string
```

ListProviders returns a list of all registered provider names.

<a name="Registry.Register"></a>
### func \(\*Registry\) [Register](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/registry.go#L33>)

```go
func (r *Registry) Register(name string, factory func(*Config) (iface.VADProvider, error))
```

Register registers a provider factory function.

<a name="VADError"></a>
## type [VADError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L33-L39>)

VADError represents an error that occurred during VAD operations. It includes an operation name, underlying error, and error code for programmatic handling.

```go
type VADError struct {
    Err     error
    Details map[string]any
    Op      string
    Code    string
    Message string
}
```

<a name="NewVADError"></a>
### func [NewVADError](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L58>)

```go
func NewVADError(op, code string, err error) *VADError
```

NewVADError creates a new VADError.

<a name="NewVADErrorWithDetails"></a>
### func [NewVADErrorWithDetails](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L77>)

```go
func NewVADErrorWithDetails(op, code, message string, err error, details map[string]any) *VADError
```

NewVADErrorWithDetails creates a new VADError with additional details.

<a name="NewVADErrorWithMessage"></a>
### func [NewVADErrorWithMessage](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L67>)

```go
func NewVADErrorWithMessage(op, code, message string, err error) *VADError
```

NewVADErrorWithMessage creates a new VADError with a custom message.

<a name="VADError.Error"></a>
### func \(\*VADError\) [Error](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L42>)

```go
func (e *VADError) Error() string
```

Error implements the error interface.

<a name="VADError.Unwrap"></a>
### func \(\*VADError\) [Unwrap](<https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/vad/errors.go#L53>)

```go
func (e *VADError) Unwrap() error
```

Unwrap returns the underlying error.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
