---
title: turndetection
sidebar_position: 1
---

<!-- Code generated by gomarkdoc. DO NOT EDIT -->


# turndetection

```go
import "github.com/lookatitude/beluga-ai/pkg/voice/turndetection"
```

Package turndetection provides advanced test utilities and comprehensive mocks for testing Turn Detection implementations.

Package turndetection provides interfaces and implementations for Turn Detection. This package follows the Beluga AI Framework's design patterns for consistency, extensibility, configuration management, and observability.

## Index

- [Constants](#constants>)
- [func AssertTurnDetectorInterface\(t \*testing.T, detector iface.TurnDetector\)](#AssertTurnDetectorInterface>)
- [func InitMetrics\(meter metric.Meter\)](#InitMetrics>)
- [func IsRetryableError\(err error\) bool](#IsRetryableError>)
- [func NewProvider\(ctx context.Context, providerName string, config \*Config, opts ...ConfigOption\) \(iface.TurnDetector, error\)](#NewProvider>)
- [type AdvancedMockTurnDetector](#AdvancedMockTurnDetector>)
  - [func NewAdvancedMockTurnDetector\(detectorName string, opts ...MockOption\) \*AdvancedMockTurnDetector](#NewAdvancedMockTurnDetector>)
  - [func \(m \*AdvancedMockTurnDetector\) DetectTurn\(ctx context.Context, audio \[\]byte\) \(bool, error\)](#AdvancedMockTurnDetector.DetectTurn>)
  - [func \(m \*AdvancedMockTurnDetector\) DetectTurnWithSilence\(ctx context.Context, audio \[\]byte, silenceDuration time.Duration\) \(bool, error\)](#AdvancedMockTurnDetector.DetectTurnWithSilence>)
  - [func \(m \*AdvancedMockTurnDetector\) GetCallCount\(\) int](#AdvancedMockTurnDetector.GetCallCount>)
- [type Config](#Config>)
  - [func DefaultConfig\(\) \*Config](#DefaultConfig>)
  - [func \(c \*Config\) Validate\(\) error](#Config.Validate>)
- [type ConfigOption](#ConfigOption>)
  - [func WithMaxTurnLength\(length int\) ConfigOption](#WithMaxTurnLength>)
  - [func WithMinSilenceDuration\(duration time.Duration\) ConfigOption](#WithMinSilenceDuration>)
  - [func WithMinTurnLength\(length int\) ConfigOption](#WithMinTurnLength>)
  - [func WithModelPath\(path string\) ConfigOption](#WithModelPath>)
  - [func WithProvider\(provider string\) ConfigOption](#WithProvider>)
  - [func WithSentenceEndMarkers\(markers string\) ConfigOption](#WithSentenceEndMarkers>)
  - [func WithThreshold\(threshold float64\) ConfigOption](#WithThreshold>)
- [type Metrics](#Metrics>)
  - [func GetMetrics\(\) \*Metrics](#GetMetrics>)
  - [func NewMetrics\(meter metric.Meter\) \*Metrics](#NewMetrics>)
  - [func \(m \*Metrics\) IncrementDetections\(ctx context.Context, provider string\)](#Metrics.IncrementDetections>)
  - [func \(m \*Metrics\) RecordDetection\(ctx context.Context, provider string, duration time.Duration, turnDetected bool\)](#Metrics.RecordDetection>)
  - [func \(m \*Metrics\) RecordError\(ctx context.Context, provider, errorCode string, duration time.Duration\)](#Metrics.RecordError>)
- [type MetricsRecorder](#MetricsRecorder>)
- [type MockOption](#MockOption>)
  - [func WithDetectorName\(name string\) MockOption](#WithDetectorName>)
  - [func WithError\(err error\) MockOption](#WithError>)
  - [func WithNetworkDelay\(enabled bool\) MockOption](#WithNetworkDelay>)
  - [func WithProcessingDelay\(delay time.Duration\) MockOption](#WithProcessingDelay>)
  - [func WithTurnResults\(results ...bool\) MockOption](#WithTurnResults>)
- [type NoOpMetrics](#NoOpMetrics>)
  - [func NewNoOpMetrics\(\) \*NoOpMetrics](#NewNoOpMetrics>)
  - [func \(n \*NoOpMetrics\) IncrementDetections\(ctx context.Context, provider string\)](#NoOpMetrics.IncrementDetections>)
  - [func \(n \*NoOpMetrics\) RecordDetection\(ctx context.Context, provider string, duration time.Duration, turnDetected bool\)](#NoOpMetrics.RecordDetection>)
  - [func \(n \*NoOpMetrics\) RecordError\(ctx context.Context, provider, errorCode string, duration time.Duration\)](#NoOpMetrics.RecordError>)
- [type Registry](#Registry>)
  - [func GetRegistry\(\) \*Registry](#GetRegistry>)
  - [func \(r \*Registry\) GetProvider\(name string, config \*Config\) \(iface.TurnDetector, error\)](#Registry.GetProvider>)
  - [func \(r \*Registry\) IsRegistered\(name string\) bool](#Registry.IsRegistered>)
  - [func \(r \*Registry\) ListProviders\(\) \[\]string](#Registry.ListProviders>)
  - [func \(r \*Registry\) Register\(name string, factory func\(\*Config\) \(iface.TurnDetector, error\)\)](#Registry.Register>)
- [type TurnDetectionError](#TurnDetectionError>)
  - [func NewTurnDetectionError\(op, code string, err error\) \*TurnDetectionError](#NewTurnDetectionError>)
  - [func NewTurnDetectionErrorWithDetails\(op, code, message string, err error, details map\[string\]any\) \*TurnDetectionError](#NewTurnDetectionErrorWithDetails>)
  - [func NewTurnDetectionErrorWithMessage\(op, code, message string, err error\) \*TurnDetectionError](#NewTurnDetectionErrorWithMessage>)
  - [func \(e \*TurnDetectionError\) Error\(\) string](#TurnDetectionError.Error>)
  - [func \(e \*TurnDetectionError\) Unwrap\(\) error](#TurnDetectionError.Unwrap>)

## Constants

Error codes for Turn Detection operations.

```go
const (
    // General errors.
    ErrCodeInvalidConfig = "invalid_config"
    ErrCodeInternalError = "internal_error"
    ErrCodeInvalidInput  = "invalid_input"
    ErrCodeTimeout       = "timeout"

    // Provider-specific errors.
    ErrCodeUnsupportedProvider = "unsupported_provider"
    ErrCodeModelLoadFailed     = "model_load_failed"
    ErrCodeModelNotFound       = "model_not_found"

    // Processing errors.
    ErrCodeProcessingError = "processing_error"
)
```


## func [AssertTurnDetectorInterface](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L162)

```go
func AssertTurnDetectorInterface(t *testing.T, detector iface.TurnDetector)
```

AssertTurnDetectorInterface ensures that a type implements the TurnDetector interface.


## func [InitMetrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/turndetection.go#L22)

```go
func InitMetrics(meter metric.Meter)
```

InitMetrics initializes the global metrics instance.


## func [IsRetryableError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L82)

```go
func IsRetryableError(err error) bool
```

IsRetryableError checks if an error is retryable.


## func [NewProvider](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/turndetection.go#L35)

```go
func NewProvider(ctx context.Context, providerName string, config *Config, opts ...ConfigOption) (iface.TurnDetector, error)
```

NewProvider creates a new Turn Detection provider instance based on the configuration. It uses the global registry to find and instantiate the appropriate provider.


## type [AdvancedMockTurnDetector](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L16-L27)

AdvancedMockTurnDetector provides a comprehensive mock implementation for testing.

```go
type AdvancedMockTurnDetector struct {
    mock.Mock
    // contains filtered or unexported fields
}
```


### func [NewAdvancedMockTurnDetector](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L30)

```go
func NewAdvancedMockTurnDetector(detectorName string, opts ...MockOption) *AdvancedMockTurnDetector
```

NewAdvancedMockTurnDetector creates a new advanced mock with configurable behavior.


### func \(\*AdvancedMockTurnDetector\) [DetectTurn](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L85)

```go
func (m *AdvancedMockTurnDetector) DetectTurn(ctx context.Context, audio []byte) (bool, error)
```

DetectTurn implements the TurnDetector interface.


### func \(\*AdvancedMockTurnDetector\) [DetectTurnWithSilence](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L134)

```go
func (m *AdvancedMockTurnDetector) DetectTurnWithSilence(ctx context.Context, audio []byte, silenceDuration time.Duration) (bool, error)
```

DetectTurnWithSilence implements the TurnDetector interface.


### func \(\*AdvancedMockTurnDetector\) [GetCallCount](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L155)

```go
func (m *AdvancedMockTurnDetector) GetCallCount() int
```

GetCallCount returns the number of times DetectTurn has been called.


## type [Config](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L12-L26)

Config represents the configuration for Turn Detection providers. It includes common settings that apply to all Turn Detection providers.

```go
type Config struct {
    ProviderSpecific        map[string]any `mapstructure:"provider_specific" yaml:"provider_specific"`
    ModelPath               string         `mapstructure:"model_path" yaml:"model_path"`
    SentenceEndMarkers      string         `mapstructure:"sentence_end_markers" yaml:"sentence_end_markers" default:".!?"`
    Provider                string         `mapstructure:"provider" yaml:"provider" validate:"required,oneof=onnx heuristic ml"`
    QuestionMarkers         []string       `mapstructure:"question_markers" yaml:"question_markers" default:"what,where,when,why,how,who,which"`
    MinTurnLength           int            `mapstructure:"min_turn_length" yaml:"min_turn_length" default:"10" validate:"min=1,max=1000"`
    MaxTurnLength           int            `mapstructure:"max_turn_length" yaml:"max_turn_length" default:"5000" validate:"min=10,max=50000"`
    Threshold               float64        `mapstructure:"threshold" yaml:"threshold" default:"0.5" validate:"gte=0.0,lte=1.0"`
    Timeout                 time.Duration  `mapstructure:"timeout" yaml:"timeout" default:"1s" validate:"min=100ms,max=10s"`
    MinSilenceDuration      time.Duration  `mapstructure:"min_silence_duration" yaml:"min_silence_duration" default:"500ms" validate:"min=100ms,max=5s"`
    EnableTracing           bool           `mapstructure:"enable_tracing" yaml:"enable_tracing" default:"true"`
    EnableMetrics           bool           `mapstructure:"enable_metrics" yaml:"enable_metrics" default:"true"`
    EnableStructuredLogging bool           `mapstructure:"enable_structured_logging" yaml:"enable_structured_logging" default:"true"`
}
```


### func [DefaultConfig](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L90)

```go
func DefaultConfig() *Config
```

DefaultConfig returns a default configuration.


### func \(\*Config\) [Validate](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L81)

```go
func (c *Config) Validate() error
```

Validate validates the configuration.


## type [ConfigOption](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L29)

ConfigOption is a functional option for configuring Turn Detection instances.

```go
type ConfigOption func(*Config)
```


### func [WithMaxTurnLength](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L53)

```go
func WithMaxTurnLength(length int) ConfigOption
```

WithMaxTurnLength sets the maximum turn length.


### func [WithMinSilenceDuration](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L39)

```go
func WithMinSilenceDuration(duration time.Duration) ConfigOption
```

WithMinSilenceDuration sets the minimum silence duration.


### func [WithMinTurnLength](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L46)

```go
func WithMinTurnLength(length int) ConfigOption
```

WithMinTurnLength sets the minimum turn length.


### func [WithModelPath](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L74)

```go
func WithModelPath(path string) ConfigOption
```

WithModelPath sets the model path.


### func [WithProvider](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L32)

```go
func WithProvider(provider string) ConfigOption
```

WithProvider sets the Turn Detection provider.


### func [WithSentenceEndMarkers](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L60)

```go
func WithSentenceEndMarkers(markers string) ConfigOption
```

WithSentenceEndMarkers sets the sentence end markers.


### func [WithThreshold](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/config.go#L67)

```go
func WithThreshold(threshold float64) ConfigOption
```

WithThreshold sets the turn detection threshold.


## type [Metrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L38-L44)

Metrics contains all the metrics for Turn Detection operations.

```go
type Metrics struct {
    // contains filtered or unexported fields
}
```


### func [GetMetrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/turndetection.go#L29)

```go
func GetMetrics() *Metrics
```

GetMetrics returns the global metrics instance.


### func [NewMetrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L47)

```go
func NewMetrics(meter metric.Meter) *Metrics
```

NewMetrics creates a new Metrics instance.


### func \(\*Metrics\) [IncrementDetections](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L85)

```go
func (m *Metrics) IncrementDetections(ctx context.Context, provider string)
```

IncrementDetections increments the detections counter.


### func \(\*Metrics\) [RecordDetection](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L60)

```go
func (m *Metrics) RecordDetection(ctx context.Context, provider string, duration time.Duration, turnDetected bool)
```

RecordDetection records a detection operation.


### func \(\*Metrics\) [RecordError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L75)

```go
func (m *Metrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
```

RecordError records an error.


## type [MetricsRecorder](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L12-L16)

MetricsRecorder defines the interface for recording metrics.

```go
type MetricsRecorder interface {
    RecordDetection(ctx context.Context, provider string, duration time.Duration, turnDetected bool)
    RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
    IncrementDetections(ctx context.Context, provider string)
}
```


## type [MockOption](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L46)

MockOption configures the behavior of AdvancedMockTurnDetector.

```go
type MockOption func(*AdvancedMockTurnDetector)
```


### func [WithDetectorName](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L49)

```go
func WithDetectorName(name string) MockOption
```

WithDetectorName sets the detector name.


### func [WithError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L63)

```go
func WithError(err error) MockOption
```

WithError configures the mock to return an error.


### func [WithNetworkDelay](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L78)

```go
func WithNetworkDelay(enabled bool) MockOption
```

WithNetworkDelay enables network delay simulation.


### func [WithProcessingDelay](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L71)

```go
func WithProcessingDelay(delay time.Duration) MockOption
```

WithProcessingDelay sets the delay for processing.


### func [WithTurnResults](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/test_utils.go#L56)

```go
func WithTurnResults(results ...bool) MockOption
```

WithTurnResults sets the turn detection results to return.


## type [NoOpMetrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L19)

NoOpMetrics provides a no\-operation implementation for when metrics are disabled.

```go
type NoOpMetrics struct{}
```


### func [NewNoOpMetrics](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L22)

```go
func NewNoOpMetrics() *NoOpMetrics
```

NewNoOpMetrics creates a new no\-operation metrics recorder.


### func \(\*NoOpMetrics\) [IncrementDetections](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L35)

```go
func (n *NoOpMetrics) IncrementDetections(ctx context.Context, provider string)
```

IncrementDetections is a no\-op implementation.


### func \(\*NoOpMetrics\) [RecordDetection](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L27)

```go
func (n *NoOpMetrics) RecordDetection(ctx context.Context, provider string, duration time.Duration, turnDetected bool)
```

RecordDetection is a no\-op implementation.


### func \(\*NoOpMetrics\) [RecordError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/metrics.go#L31)

```go
func (n *NoOpMetrics) RecordError(ctx context.Context, provider, errorCode string, duration time.Duration)
```

RecordError is a no\-op implementation.


## type [Registry](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L17-L20)

Registry manages Turn Detection provider registration and retrieval.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```


### func [GetRegistry](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L23)

```go
func GetRegistry() *Registry
```

GetRegistry returns the global registry instance.


### func \(\*Registry\) [GetProvider](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L40)

```go
func (r *Registry) GetProvider(name string, config *Config) (iface.TurnDetector, error)
```

GetProvider returns a provider instance for the given name.


### func \(\*Registry\) [IsRegistered](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L66)

```go
func (r *Registry) IsRegistered(name string) bool
```

IsRegistered checks if a provider is registered.


### func \(\*Registry\) [ListProviders](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L54)

```go
func (r *Registry) ListProviders() []string
```

ListProviders returns a list of all registered provider names.


### func \(\*Registry\) [Register](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/registry.go#L33)

```go
func (r *Registry) Register(name string, factory func(*Config) (iface.TurnDetector, error))
```

Register registers a provider factory function.


## type [TurnDetectionError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L27-L33)

TurnDetectionError represents an error that occurred during Turn Detection operations. It includes an operation name, underlying error, and error code for programmatic handling.

```go
type TurnDetectionError struct {
    Err     error
    Details map[string]any
    Op      string
    Code    string
    Message string
}
```


### func [NewTurnDetectionError](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L52)

```go
func NewTurnDetectionError(op, code string, err error) *TurnDetectionError
```

NewTurnDetectionError creates a new TurnDetectionError.


### func [NewTurnDetectionErrorWithDetails](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L71)

```go
func NewTurnDetectionErrorWithDetails(op, code, message string, err error, details map[string]any) *TurnDetectionError
```

NewTurnDetectionErrorWithDetails creates a new TurnDetectionError with additional details.


### func [NewTurnDetectionErrorWithMessage](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L61)

```go
func NewTurnDetectionErrorWithMessage(op, code, message string, err error) *TurnDetectionError
```

NewTurnDetectionErrorWithMessage creates a new TurnDetectionError with a custom message.


### func \(\*TurnDetectionError\) [Error](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L36)

```go
func (e *TurnDetectionError) Error() string
```

Error implements the error interface.


### func \(\*TurnDetectionError\) [Unwrap](https://github.com/lookatitude/beluga-ai/blob/main/pkg/voice/turndetection/errors.go#L47)

```go
func (e *TurnDetectionError) Unwrap() error
```

Unwrap returns the underlying error.

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
