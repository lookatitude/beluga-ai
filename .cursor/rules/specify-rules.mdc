---
description: Speckit rules for specs, plans, and tasks.
globs: specs/**/*.md
alwaysApply: true
---
# Beluga AI Specification Rules

**MANDATORY**: All work MUST comply with Framework standards (`design-patterns`, `test`, `architecture`, `quality`, `kb`).

## Research (MANDATORY)
1.  **KB Context**: Check `.project-kb`. Query `kb_auto_context` / `kb_search` (patterns, deps, arch).
2.  **Deep Dive**: Codebase search, dependency mapping, integration points.
3.  **Ask**: Clarify boundaries, requirements, testing.

## Technical Requirements

### Package Structure
`pkg/{name}/`: `iface/`, `config.go` (valid), `metrics.go` (OTEL), `errors.go` (Op/Err/Code), `test_utils.go` (Mocks), `advanced_test.go`, `README.md`.

### Principles
-   **Design**: ISP, DIP, SRP, Composition.
-   **Observability**: **OTEL ONLY** (Metrics/Tracing/Logs).
-   **Errors**: Op/Err/Code, Context aware.
-   **Testing**: Advanced Mocks, Table-driven, Concurrency, Load, Benchmarks, Integration.
-   **Quality**: Lint, Format, Vet, Security, Build.

## Task Creation Rules
**Always create tasks for:**
1.  **Structure**: `iface`, config, metrics, errors, test_utils.
2.  **Impl**: Core, Providers, Factory.
3.  **Testing**: Unit, Concurrency, Load, Integration.
4.  **Quality**: Lint, Security, Docs.
5.  **KB**: Update KB with new files/patterns.

## Plan Structure (`plan.md`)
1.  **Context**: Deps, Integrations, Arch alignment.
2.  **Constitution**: ISP/DIP/SRP check.
3.  **Phases**: Research → Foundation → Core → Extensions → Testing → Integration → Docs.
4.  **Gates**: Lint, Test, Security, KB.

## Specification Requirements (`spec.md`)
1.  **Alignment**: Patterns, Arch, Integrations.
2.  **Completeness**: Files, Tests, Docs specified.
3.  **Research**: Document findings, decisions.
4.  **KB Update**: Add Spec/Plan/Tasks to KB with metadata.

## Active Technologies
-   **Go**: 1.24+ (matches `go.mod`).
-   **OTEL**: `go.opentelemetry.io/otel`.
-   **Testing**: `testify`, `validator/v10`.
-   **Config**: `viper`, `mapstructure`.
-   **Docs**: Docusaurus 3.9.2.
